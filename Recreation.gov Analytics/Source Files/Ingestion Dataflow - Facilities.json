{"name":"Ingestion Dataflow - Facilities","ppdf:dataflowId":"5522ba5b-11bb-40c4-9f2e-473b4f4dbe9e","ppdf:owner":{"tenantId":"f77a80c9-6910-4bdc-b61b-817066d56b46","userId":"d66f10cd-daab-40af-841c-0f1b49df5934"},"ppdf:fastCopy":false,"version":"1.0","culture":"en-US","modifiedTime":"2024-08-26T13:20:16.1828596+00:00","ppdf:outputFileFormat":"Parquet","pbi:mashup":{"fastCombine":false,"allowNativeQueries":true,"queriesMetadata":{"FacilityData":{"queryId":"60dbe7fa-c4ba-44b0-abfc-64b1c2267b71","queryName":"FacilityData"},"Sample file":{"queryId":"ce8d5e78-1c61-4621-9eed-6f4e93a2bdb3","queryName":"Sample file","queryGroupId":"04d9312a-b3d4-46ee-818e-ce320bf6a3e8"},"Parameter":{"queryId":"26e1ad81-39b8-4b6e-9dac-27d931c72a49","queryName":"Parameter","queryGroupId":"04d9312a-b3d4-46ee-818e-ce320bf6a3e8"},"Transform Sample file":{"queryId":"0d82d0c8-70e9-48e1-9624-9d6d29fc958b","queryName":"Transform Sample file","queryGroupId":"8effb659-13cc-4285-b4e1-fc095f06d38e"},"Transform file":{"queryId":"43daaaed-f5a5-4afc-a5ea-0b0251ce0113","queryName":"Transform file","queryGroupId":"04d9312a-b3d4-46ee-818e-ce320bf6a3e8"},"FacilityData_DataDestination":{"queryId":"f790d860-84eb-4482-9cc5-290f302cc927","queryName":"FacilityData_DataDestination"},"FacilityData_WriteToDataDestination":{"queryId":"1db0152a-8f73-45eb-bc4b-7521db2b210a","queryName":"FacilityData_WriteToDataDestination"},"FacilityData_TransformForWriteToDataDestination":{"queryId":"dc726d2d-296c-45fe-a7bf-d511ec1e1298","queryName":"FacilityData_TransformForWriteToDataDestination"}},"document":"section Section1;\r\nshared FacilityData = let\r\n  Source = Lakehouse.Contents([]),\r\n  #\"Navigation 1\" = Source{[workspaceId = \"fb8c5c0a-2620-4db1-9e75-976ad2f69b69\"]}[Data],\r\n  #\"Navigation 2\" = #\"Navigation 1\"{[lakehouseId = \"57295ad7-476c-4050-80d4-def33926306d\"]}[Data],\r\n  #\"Navigation 3\" = #\"Navigation 2\"{[Id = \"Files\", ItemKind = \"Folder\"]}[Data],\r\n  #\"Navigation 4\" = #\"Navigation 3\"{[Name = \"FacilityData\"]}[Content],\r\n  #\"Expanded Attributes\" = Table.ExpandRecordColumn(#\"Navigation 4\", \"Attributes\", {\"Content Type\", \"Kind\", \"Size\", \"Group\", \"Owner\", \"Permissions\"}, {\"Content Type\", \"Kind\", \"Size\", \"Group\", \"Owner\", \"Permissions\"}),\r\n  #\"Filtered hidden files\" = Table.SelectRows(#\"Expanded Attributes\", each [Attributes]?[Hidden]? <> true),\r\n  #\"Invoke custom function\" = Table.AddColumn(#\"Filtered hidden files\", \"Transform file\", each #\"Transform file\"([Content])),\r\n  #\"Removed other columns\" = Table.SelectColumns(#\"Invoke custom function\", {\"Transform file\"}),\r\n  #\"Expanded Transform file\" = Table.ExpandTableColumn(#\"Removed other columns\", \"Transform file\", {\"CURRENT_COUNT\", \"TOTAL_COUNT\", \"LIMIT\", \"OFFSET\", \"QUERY\", \"ACTIVITY\", \"CAMPSITE\", \"EVENT\", \"Enabled\", \"FACILITYADDRESS\", \"FacilityAccessibilityText\", \"FacilityAdaAccess\", \"FacilityDescription\", \"FacilityDirections\", \"FacilityEmail\", \"FacilityID\", \"FacilityLatitude\", \"FacilityLongitude\", \"FacilityMapURL\", \"FacilityName\", \"FacilityPhone\", \"FacilityReservationURL\", \"FacilityTypeDescription\", \"FacilityUseFeeDescription\", \"COORDINATES.0\", \"COORDINATES.1\", \"TYPE\", \"Keywords\", \"LINK\", \"LastUpdatedDate\", \"LegacyFacilityID\", \"MEDIA\", \"ORGANIZATION\", \"OrgFacilityID\", \"PERMITENTRANCE\", \"ParentOrgID\", \"ParentRecAreaID\", \"RECAREA\", \"Reservable\", \"StayLimit\", \"TOUR\"}, {\"CURRENT_COUNT\", \"TOTAL_COUNT\", \"LIMIT\", \"OFFSET\", \"QUERY\", \"ACTIVITY\", \"CAMPSITE\", \"EVENT\", \"Enabled\", \"FACILITYADDRESS\", \"FacilityAccessibilityText\", \"FacilityAdaAccess\", \"FacilityDescription\", \"FacilityDirections\", \"FacilityEmail\", \"FacilityID\", \"FacilityLatitude\", \"FacilityLongitude\", \"FacilityMapURL\", \"FacilityName\", \"FacilityPhone\", \"FacilityReservationURL\", \"FacilityTypeDescription\", \"FacilityUseFeeDescription\", \"COORDINATES.0\", \"COORDINATES.1\", \"TYPE\", \"Keywords\", \"LINK\", \"LastUpdatedDate\", \"LegacyFacilityID\", \"MEDIA\", \"ORGANIZATION\", \"OrgFacilityID\", \"PERMITENTRANCE\", \"ParentOrgID\", \"ParentRecAreaID\", \"RECAREA\", \"Reservable\", \"StayLimit\", \"TOUR\"}),\r\n  #\"Removed columns\" = Table.RemoveColumns(#\"Expanded Transform file\", {\"CURRENT_COUNT\", \"TOTAL_COUNT\", \"LIMIT\", \"OFFSET\", \"QUERY\", \"FACILITYADDRESS\", \"Enabled\", \"EVENT\", \"CAMPSITE\", \"ACTIVITY\", \"LINK\", \"ORGANIZATION\", \"RECAREA\", \"TOUR\", \"PERMITENTRANCE\", \"COORDINATES.0\", \"COORDINATES.1\"}),\r\n  #\"Expanded MEDIA\" = Table.ExpandListColumn(#\"Removed columns\", \"MEDIA\"),\r\n  #\"Expanded MEDIA 1\" = Table.ExpandRecordColumn(#\"Expanded MEDIA\", \"MEDIA\", {\"Credits\", \"Description\", \"EmbedCode\", \"EntityID\", \"EntityMediaID\", \"EntityType\", \"Height\", \"IsGallery\", \"IsPreview\", \"IsPrimary\", \"MediaType\", \"Subtitle\", \"Title\", \"URL\", \"Width\"}, {\"Credits\", \"Description\", \"EmbedCode\", \"EntityID\", \"EntityMediaID\", \"EntityType\", \"Height\", \"IsGallery\", \"IsPreview\", \"IsPrimary\", \"MediaType\", \"Subtitle\", \"Title\", \"URL\", \"Width\"}),\r\n  #\"Changed column type\" = Table.TransformColumnTypes(#\"Expanded MEDIA 1\", {{\"FacilityAccessibilityText\", type text}, {\"FacilityAdaAccess\", type text}, {\"FacilityDescription\", type text}, {\"FacilityDirections\", type text}, {\"FacilityEmail\", type text}, {\"FacilityID\", type text}, {\"FacilityLatitude\", type number}, {\"FacilityLongitude\", type number}, {\"FacilityMapURL\", type text}, {\"FacilityName\", type text}, {\"FacilityPhone\", type text}, {\"FacilityReservationURL\", type text}, {\"FacilityTypeDescription\", type text}, {\"FacilityUseFeeDescription\", type text}, {\"TYPE\", type text}, {\"Keywords\", type text}, {\"LastUpdatedDate\", type date}, {\"LegacyFacilityID\", type text}, {\"Credits\", type text}, {\"Description\", type text}, {\"EmbedCode\", type text}, {\"EntityID\", type text}, {\"EntityMediaID\", type text}, {\"EntityType\", type text}, {\"Height\", type number}, {\"IsGallery\", type logical}, {\"IsPreview\", type logical}, {\"IsPrimary\", type logical}, {\"MediaType\", type text}, {\"Subtitle\", type text}, {\"Title\", type text}, {\"URL\", type text}, {\"Width\", type number}, {\"OrgFacilityID\", type text}, {\"ParentOrgID\", type text}, {\"ParentRecAreaID\", type text}, {\"Reservable\", type logical}, {\"StayLimit\", type text}}),\r\n  #\"Removed columns 1\" = Table.RemoveColumns(#\"Changed column type\", {\"EmbedCode\"}),\r\n  #\"Filtered rows\" = Table.SelectRows(#\"Removed columns 1\", each ([FacilityID] <> null))\r\nin\r\n  #\"Filtered rows\";\r\nshared #\"Sample file\" = let\r\n  Source = Lakehouse.Contents([]),\r\n  #\"Navigation 1\" = Source{[workspaceId = \"fb8c5c0a-2620-4db1-9e75-976ad2f69b69\"]}[Data],\r\n  #\"Navigation 2\" = #\"Navigation 1\"{[lakehouseId = \"57295ad7-476c-4050-80d4-def33926306d\"]}[Data],\r\n  #\"Navigation 3\" = #\"Navigation 2\"{[Id = \"Files\", ItemKind = \"Folder\"]}[Data],\r\n  #\"Navigation 4\" = #\"Navigation 3\"{[Name = \"FacilityData\"]}[Content],\r\n  #\"Expanded Attributes\" = Table.ExpandRecordColumn(#\"Navigation 4\", \"Attributes\", {\"Content Type\", \"Kind\", \"Size\", \"Group\", \"Owner\", \"Permissions\"}, {\"Content Type\", \"Kind\", \"Size\", \"Group\", \"Owner\", \"Permissions\"}),\r\n  #\"Filtered hidden files\" = Table.SelectRows(#\"Expanded Attributes\", each [Attributes]?[Hidden]? <> true),\r\n  Navigation = #\"Filtered hidden files\"{0}[Content]\r\nin\r\n  Navigation;\r\nshared Parameter = let\r\n  Parameter = #\"Sample file\" meta [IsParameterQuery = true, IsParameterQueryRequired = true, Type = type binary, BinaryIdentifier = #\"Sample file\"]\r\nin\r\n  Parameter;\r\nshared #\"Transform Sample file\" = let\r\n  Source = Json.Document(Parameter, 65001),\r\n  #\"Converted to table\" = Table.FromRecords({Source}),\r\n  #\"Expanded METADATA\" = Table.ExpandRecordColumn(#\"Converted to table\", \"METADATA\", {\"RESULTS\", \"SEARCH_PARAMETERS\"}, {\"RESULTS\", \"SEARCH_PARAMETERS\"}),\r\n  #\"Expanded METADATA.RESULTS\" = Table.ExpandRecordColumn(#\"Expanded METADATA\", \"RESULTS\", {\"CURRENT_COUNT\", \"TOTAL_COUNT\"}, {\"CURRENT_COUNT\", \"TOTAL_COUNT\"}),\r\n  #\"Expanded METADATA.SEARCH_PARAMETERS\" = Table.ExpandRecordColumn(#\"Expanded METADATA.RESULTS\", \"SEARCH_PARAMETERS\", {\"LIMIT\", \"OFFSET\", \"QUERY\"}, {\"LIMIT\", \"OFFSET\", \"QUERY\"}),\r\n  #\"Expanded RECDATA\" = Table.ExpandListColumn(#\"Expanded METADATA.SEARCH_PARAMETERS\", \"RECDATA\"),\r\n  #\"Expanded RECDATA1\" = Table.ExpandRecordColumn(#\"Expanded RECDATA\", \"RECDATA\", {\"ACTIVITY\", \"CAMPSITE\", \"EVENT\", \"Enabled\", \"FACILITYADDRESS\", \"FacilityAccessibilityText\", \"FacilityAdaAccess\", \"FacilityDescription\", \"FacilityDirections\", \"FacilityEmail\", \"FacilityID\", \"FacilityLatitude\", \"FacilityLongitude\", \"FacilityMapURL\", \"FacilityName\", \"FacilityPhone\", \"FacilityReservationURL\", \"FacilityTypeDescription\", \"FacilityUseFeeDescription\", \"GEOJSON\", \"Keywords\", \"LINK\", \"LastUpdatedDate\", \"LegacyFacilityID\", \"MEDIA\", \"ORGANIZATION\", \"OrgFacilityID\", \"PERMITENTRANCE\", \"ParentOrgID\", \"ParentRecAreaID\", \"RECAREA\", \"Reservable\", \"StayLimit\", \"TOUR\"}, {\"ACTIVITY\", \"CAMPSITE\", \"EVENT\", \"Enabled\", \"FACILITYADDRESS\", \"FacilityAccessibilityText\", \"FacilityAdaAccess\", \"FacilityDescription\", \"FacilityDirections\", \"FacilityEmail\", \"FacilityID\", \"FacilityLatitude\", \"FacilityLongitude\", \"FacilityMapURL\", \"FacilityName\", \"FacilityPhone\", \"FacilityReservationURL\", \"FacilityTypeDescription\", \"FacilityUseFeeDescription\", \"GEOJSON\", \"Keywords\", \"LINK\", \"LastUpdatedDate\", \"LegacyFacilityID\", \"MEDIA\", \"ORGANIZATION\", \"OrgFacilityID\", \"PERMITENTRANCE\", \"ParentOrgID\", \"ParentRecAreaID\", \"RECAREA\", \"Reservable\", \"StayLimit\", \"TOUR\"}),\r\n  #\"Expanded RECDATA.GEOJSON\" = Table.ExpandRecordColumn(#\"Expanded RECDATA1\", \"GEOJSON\", {\"COORDINATES\", \"TYPE\"}, {\"COORDINATES\", \"TYPE\"}),\r\n  #\"Split column\" = Table.SplitColumn(#\"Expanded RECDATA.GEOJSON\", \"COORDINATES\", each _, {\"COORDINATES.0\", \"COORDINATES.1\"})\r\nin\r\n  #\"Split column\";\r\n[FunctionQueryBinding = \"{\"\"exemplarFormulaName\"\":\"\"Transform Sample file\"\"}\"]\r\nshared #\"Transform file\" = let\r\n  #\"Transform file\" = (Parameter as binary) => let\r\n  Source = Json.Document(Parameter, 65001),\r\n  #\"Converted to table\" = Table.FromRecords({Source}),\r\n  #\"Expanded METADATA\" = Table.ExpandRecordColumn(#\"Converted to table\", \"METADATA\", {\"RESULTS\", \"SEARCH_PARAMETERS\"}, {\"RESULTS\", \"SEARCH_PARAMETERS\"}),\r\n  #\"Expanded METADATA.RESULTS\" = Table.ExpandRecordColumn(#\"Expanded METADATA\", \"RESULTS\", {\"CURRENT_COUNT\", \"TOTAL_COUNT\"}, {\"CURRENT_COUNT\", \"TOTAL_COUNT\"}),\r\n  #\"Expanded METADATA.SEARCH_PARAMETERS\" = Table.ExpandRecordColumn(#\"Expanded METADATA.RESULTS\", \"SEARCH_PARAMETERS\", {\"LIMIT\", \"OFFSET\", \"QUERY\"}, {\"LIMIT\", \"OFFSET\", \"QUERY\"}),\r\n  #\"Expanded RECDATA\" = Table.ExpandListColumn(#\"Expanded METADATA.SEARCH_PARAMETERS\", \"RECDATA\"),\r\n  #\"Expanded RECDATA1\" = Table.ExpandRecordColumn(#\"Expanded RECDATA\", \"RECDATA\", {\"ACTIVITY\", \"CAMPSITE\", \"EVENT\", \"Enabled\", \"FACILITYADDRESS\", \"FacilityAccessibilityText\", \"FacilityAdaAccess\", \"FacilityDescription\", \"FacilityDirections\", \"FacilityEmail\", \"FacilityID\", \"FacilityLatitude\", \"FacilityLongitude\", \"FacilityMapURL\", \"FacilityName\", \"FacilityPhone\", \"FacilityReservationURL\", \"FacilityTypeDescription\", \"FacilityUseFeeDescription\", \"GEOJSON\", \"Keywords\", \"LINK\", \"LastUpdatedDate\", \"LegacyFacilityID\", \"MEDIA\", \"ORGANIZATION\", \"OrgFacilityID\", \"PERMITENTRANCE\", \"ParentOrgID\", \"ParentRecAreaID\", \"RECAREA\", \"Reservable\", \"StayLimit\", \"TOUR\"}, {\"ACTIVITY\", \"CAMPSITE\", \"EVENT\", \"Enabled\", \"FACILITYADDRESS\", \"FacilityAccessibilityText\", \"FacilityAdaAccess\", \"FacilityDescription\", \"FacilityDirections\", \"FacilityEmail\", \"FacilityID\", \"FacilityLatitude\", \"FacilityLongitude\", \"FacilityMapURL\", \"FacilityName\", \"FacilityPhone\", \"FacilityReservationURL\", \"FacilityTypeDescription\", \"FacilityUseFeeDescription\", \"GEOJSON\", \"Keywords\", \"LINK\", \"LastUpdatedDate\", \"LegacyFacilityID\", \"MEDIA\", \"ORGANIZATION\", \"OrgFacilityID\", \"PERMITENTRANCE\", \"ParentOrgID\", \"ParentRecAreaID\", \"RECAREA\", \"Reservable\", \"StayLimit\", \"TOUR\"}),\r\n  #\"Expanded RECDATA.GEOJSON\" = Table.ExpandRecordColumn(#\"Expanded RECDATA1\", \"GEOJSON\", {\"COORDINATES\", \"TYPE\"}, {\"COORDINATES\", \"TYPE\"}),\r\n  #\"Split column\" = Table.SplitColumn(#\"Expanded RECDATA.GEOJSON\", \"COORDINATES\", each _, {\"COORDINATES.0\", \"COORDINATES.1\"})\r\nin\r\n  #\"Split column\"\r\nin\r\n  #\"Transform file\";\r\nshared DefaultStaging = let\r\n  DefaultStaging = Pipeline.DefaultModelStorage()\r\nin\r\n  DefaultStaging;\r\nshared FacilityData_DataDestination = let\r\n  Pattern = Lakehouse.Contents([CreateNavigationProperties = false]),\r\n  Navigation_1 = Pattern{[workspaceId = \"fb8c5c0a-2620-4db1-9e75-976ad2f69b69\"]}[Data],\r\n  Navigation_2 = Navigation_1{[lakehouseId = \"57295ad7-476c-4050-80d4-def33926306d\"]}[Data],\r\n  TableNavigation = Navigation_2{[Id = \"Facility_Data\", ItemKind = \"Table\"]}?[Data]?,\r\n  Table = NavigationTable.CreateTableOnDemand(TableNavigation, #table(type table[FacilityAccessibilityText = nullable Text.Type, FacilityAdaAccess = nullable Text.Type, FacilityDescription = nullable Text.Type, FacilityDirections = nullable Text.Type, FacilityEmail = nullable Text.Type, FacilityID = nullable Text.Type, FacilityLatitude = nullable Number.Type, FacilityLongitude = nullable Number.Type, FacilityMapURL = nullable Text.Type, FacilityName = nullable Text.Type, FacilityPhone = nullable Text.Type, FacilityReservationURL = nullable Text.Type, FacilityTypeDescription = nullable Text.Type, FacilityUseFeeDescription = nullable Text.Type, TYPE = nullable Text.Type, Keywords = nullable Text.Type, LastUpdatedDate = nullable Date.Type, LegacyFacilityID = nullable Text.Type, Credits = nullable Text.Type, Description = nullable Text.Type, EntityID = nullable Text.Type, EntityMediaID = nullable Text.Type, EntityType = nullable Text.Type, Height = nullable Number.Type, IsGallery = nullable Logical.Type, IsPreview = nullable Logical.Type, IsPrimary = nullable Logical.Type, MediaType = nullable Text.Type, Subtitle = nullable Text.Type, Title = nullable Text.Type, URL = nullable Text.Type, Width = nullable Number.Type, OrgFacilityID = nullable Text.Type, ParentOrgID = nullable Text.Type, ParentRecAreaID = nullable Text.Type, Reservable = nullable Logical.Type, StayLimit = nullable Text.Type], {}), [DeleteWhenEmpty = true])\r\nin\r\n  Table;\r\n[Staging = \"DefaultStaging\"]\r\nshared FacilityData_WriteToDataDestination = let\r\n  FacilityData_WriteToDataDestination = Pipeline.ExecuteAction(ValueAction.WithTransaction([Target = FacilityData_DataDestination], (txn) => {TableAction.DeleteRows(txn[Target]), () => TableAction.InsertRows(txn[Target], FacilityData_TransformForWriteToDataDestination), Action.DoNothing}))\r\nin\r\n  FacilityData_WriteToDataDestination;\r\nshared FacilityData_TransformForWriteToDataDestination = let\r\n    SourceTable = Table.SelectColumns(FacilityData, {\"FacilityAccessibilityText\", \"FacilityAdaAccess\", \"FacilityDescription\", \"FacilityDirections\", \"FacilityEmail\", \"FacilityID\", \"FacilityLatitude\", \"FacilityLongitude\", \"FacilityMapURL\", \"FacilityName\", \"FacilityPhone\", \"FacilityReservationURL\", \"FacilityTypeDescription\", \"FacilityUseFeeDescription\", \"TYPE\", \"Keywords\", \"LastUpdatedDate\", \"LegacyFacilityID\", \"Credits\", \"Description\", \"EntityID\", \"EntityMediaID\", \"EntityType\", \"Height\", \"IsGallery\", \"IsPreview\", \"IsPrimary\", \"MediaType\", \"Subtitle\", \"Title\", \"URL\", \"Width\", \"OrgFacilityID\", \"ParentOrgID\", \"ParentRecAreaID\", \"Reservable\", \"StayLimit\"})\r\nin\r\n    SourceTable;\r\n","connectionOverrides":[{"path":"Lakehouse","kind":"Lakehouse","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"Lakehouse\",\"path\":\"Lakehouse\"}","audience":null}]},"annotations":[{"name":"pbi:QueryGroups","value":"[{\"Id\":\"8effb659-13cc-4285-b4e1-fc095f06d38e\",\"Name\":\"Transform file from FacilityData\",\"Description\":null,\"ParentId\":null,\"Order\":0},{\"Id\":\"04d9312a-b3d4-46ee-818e-ce320bf6a3e8\",\"Name\":\"Helper queries\",\"Description\":null,\"ParentId\":\"8effb659-13cc-4285-b4e1-fc095f06d38e\",\"Order\":0}]"}]}